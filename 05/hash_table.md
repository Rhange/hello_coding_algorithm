# Hash Table

- 가격표에서 'apple'의 가격을 O(1) 시간에 찾을 수 있게 해주는 것, 그것이 바로 해시 함수(hash function)이다.
- 해시 함수는 **문자열(string)을 받아서 숫자를 반환\***하는 함수이다.
- 다시 말해서 해시 함수는 **문자열에 대해 숫자를 할당(mapping)**한다.

## Hash function의 자격 요건

1. 해시 함수에는 '일관성'이 있어야 한다. 예를 들어, 만약 "apple"을 넣었을 때, "4"를 반환한다면 "apple"을 넣을 때마다 반환되는 값은 항상 "4"이어야 한다. 그렇지 않으면 해시 함수로서의 역할을 할 수 없다. (**일관성**)
2. 다른 단어가 들어가면 다른 숫자가 나와야 한다. 예를 들어, 어떤 단어를 넣어도 "1"만 나온다면 좋은 해시 함수가 아니다. 가장 좋은 경우는 서로 다른 단어에 대해 모두 서로 다른 숫자가 나와야 한다. (**분포성**)

## Hash function이 가능한 이유

- **같은 이름에 대해서는 항상 같은 '인덱스'를 할당**한다. 예를 들어 "avocado"를 넣을 때마다 똑같은 숫자를 얻을 수 있다. 그래야지 avocado 가격을 처음 저장할 때도 사용하고, 이후에 그 가격을 저장한 위치를 찾을 때도 사용할 수 있기 때문이다.
- 해시 함수는 **다른 문자열에 대해서는 다른 인덱스를 할당**한다. 만약 "avocado"에 인덱스 4가 할당되었다면 "milk"에는 인덱스 0이 할당되어야 한다. 그렇게 되면 모든 가격을 각각 배열의 다른 위치에 저장하게 된다.
- 해시 함수는 여러분의 배열이 얼마나 큰지 알고 있어야 하며, 유효한 인덱스만 반환해야 한다. 만약 배열이 5개의 원소만 가질 수 있다면 100을 반환해서는 안된다. 이 배열에서는 유효한 인덱스가 아니기 때문이다.

## 해시 함수(hash function) + 배열(array) = 해시 테이블(hash table): DataStructure

- 해시 테이블은 여러분이 배우는 자료구조 중에서 자료구조 그 자체 외에도 해시 함수라는 **'추가적인 논리구조'를 가지는 첫 번째 자료구조**이다.
- 배열과 리스트는 직접 메모리를 할당하지만, 해시 테이블은 해시 함수를 사용해서 더 총명하게 어디에 원소를 저장할지 결정한다.
- 해시 테이블은 해시 맵(hash maps), 맵(maps), 딕셔너리(dictionaries, Python), 연관 배열(associative arrays)이라는 이름으로도 알려져 있다.
- 무엇보다 해시 테이블은 속도가 빠르다. 배열에서는 원소를 순간적으로 얻을 수 있었는데, **해시 테이블도 자료를 저장할 때 배열을 사용하여** 마찬가지로 속도도 빠르다. 해시 테이블이 배열을 사용하는 방법은 입력한 문자열을 숫자(배열의 인덱스에 해당함)로 해시 함수로 변환한 뒤, 이 인덱스 위치에 해당하는 배열의 원소값을 읽는 것이다.
- 아마도 여러분은 해시 테이블을 직접 구현할 일은 없을 겁니다. 대부분의 좋은 프로그래밍 언어들은 해시 테이블이 구현되어 있다. 파이썬에도 딕셔너리라고 불리는 해시 테이블이 있다.
- 해시 테이블은 키(key)와 값(value)을 가진다.

## 해시 테이블을 사용하는 예

- 해시 테이블은 다음과 같은 일을 하고자 할 때 유용하다.
  - 어떤 것을 다른 것과 연관시키고자 할 때
  - 무언가를 찾아보고자 할 때
- 어떤 웹 사이트에 접속하든 그 주소는 모두 IP 주소로 번역되어야 한다.
- 웹 주소에 대해 IP 주소를 할당하는 작업을 DNS 확인(DNS resolution) 작업이라고 한다. 해시 테이블을 이 기능을 제공하는 방법 중의 하나이다.

## 해시 테이블을 캐시로 사용하기

- 정보를 다시 계산하지 않고(찾지 않고) 저장했다가 알려주는 것이 캐싱(caching)이다.

### 캐싱의 두 가지 장점

1. 마치 달까지의 거리를 외우고 있을 때처럼 웹 페이지를 더 빨리 보여준다. 외우고 있으면 조카가 또 물어볼 때 구글에 검색할 필요 없이 바로 대답할 수 있기 때문이다.
2. 페이스북이 일을 '덜' 할 수 있다.

- 캐싱은 작업 속도를 올리는 일반적인 방법이다. 모든 대형 웹 사이트는 캐싱을 사용한다. 그리고 **그 자료는 바로 해시 테이블에 저장**된다!
- 페이스북은 홈페이지만 캐싱하는 것이 아니라 회사 소개, 회사 연락처, 사용 약관 등 많은 것을 캐싱하고 있다. 그래서 페이지 URL에 해당 페이지의 자료를 할당한다.
  - facebook.com/about -> 회사 소개 페이지 자료
  - facebook.com -> 메인 페이지 자료

### Hash Table 장점 정리

1. 어떤 것과 다른 것 사이의 관계를 '모형화'할 수 있다.
2. '중복'을 막을 수 있다.
3. 서버에게 작업을 시키지 않고 자료를 '캐싱'할 수 있다.

### 충돌(Collision)

- 배열에 key를 넣으려고 할 때, **두 개의 키가 같은 공간에 할당되는 경우를 충돌**이라고 함.

  1. 해시 함수는 정말 중요하다. 이상적으로는 해시 함수는 키를 해시 테이블 전체에 고르게 할당해야 한다.
  2. 만약 연결 리스트가 길어지면 해시 테이블의 속도도 느려진다. 하지만 좋은 해시 함수가 있다면 그런 일은 발생하지 않는다.
  3. 좋은 해시 함수는 충돌을 최소화한다.

### 성능

- O(1), 상수 시간(constant time): 순간적이라는 뜻이 아니라 **해시 테이블의 크기에 상관없이 항상 똑같은 시간**이 걸린다는 의미
- 해시 테이블은 평균적으로 read, insert, delete에서 O(1)이지만 최악의 상황에서는 O(n)이 걸린다.
- 최악의 상황이 발생하지 않도록 '충돌'을 피해야하고 이를 위해서는 두 가지 조건이 필요하다.
  - 낮은 사용률
  - 좋은 해시 함수

|      | 해시 테이블(평균) | 해시 테이블(최악) | 배열 | 연결 리스트 |
| :--: | :---------------: | :---------------: | :--: | :---------: |
| 탐색 |       O(1)        |       O(n)        | O(1) |    O(n)     |
| 삽입 |       O(1)        |       O(n)        | O(n) |    O(1)     |
| 삭제 |       O(1)        |       O(n)        | O(n) |    O(1)     |

### 사용률(Load factor)

- 해시 테이블에 있는 항목의 수 / 해시 테이블에 있는 공간의 수
- 사용률이 1보다 크다는 것은 배열 공간의 수보다 항목의 수가 많다는 뜻
- 리사이징(resizing): 사용률이 커지기 시작하면 해시 테이블의 공간을 추가하는 작업
- 리사이징은 기존의 해시 테이블의 배열에서 대략 두 배 정도의 크기로 배열을 만드는 것이 보통이며, 0.7보다 커지면 리사이징한다.
- 사용률이 낮을수록 충돌이 적게 일어나고, 해시 테이블 성능도 좋아진다.
- 리사이징은 엄청 비싼 작업이고 자주 하지 않는 것이 좋지만, 해시 테이블은 리사이징을 해도 평균적으로 O(1) 시간이 걸린다.

### 좋은 해시 함수란?

- 배열에 값을 고루 분포시키는 함수
- 나쁜 해시 함수는 값들이 뭉쳐져 있어서 충돌이 자주 발생한다. (배열의 한 자리에 연결 리스트로 여러개 넣는 경우)

## 정리

- 해시 테이블 = 해시 함수 + 배열
- 충돌은 나쁘다. 충돌을 줄이는 해시 함수가 있어야 한다.
- 해시 테이블은 정말 빠른 탐색, 삽입, 삭제 속도를 가진다.
- 해시 테이블은 어떤 항목과 다른 항목의 관계를 모형화하는 데 좋다.
- 사용률이 0.7보다 커지면 해시 테이블을 resizing할 때이다.
- 해시 테이블은 (웹 서버 등에서) 데이터를 캐싱(caching)하는 데도 사용된다.
- 해시 테이블은 중복을 잡아내는 데도 뛰어나다.
